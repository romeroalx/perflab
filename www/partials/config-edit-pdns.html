<div class="container">

  <div class="row" ng-show="existing">
	<div class="col-md-12">
	  <div>&nbsp;</div>
	  <div class="alert alert-danger alert-dismissable" role="alert">
<b>NB:</b> There are existing results for this configuration.  Please be advised
that editing this configuration may invalidate any comparisons between
pre- and post-edit results.
	  </div>
	</div>
  </div>
  <br ng-show="existing" />

  <div class="row">
	<div class="col-md-12">
	  <div class="card">
	  <div class="card-header">
	  <span class="float-title">Configuration</span>
	  <span class="float-right">
		<cfg-button-graph ng-cloak ng-show="existing" />
		<cfg-button-list ng-cloak ng-show="existing" />
		<cfg-button-export ng-cloak ng-show="existing" />
	  </span>
	  </div>
	  <div class="card-body">
		<form name="form">
		  <div class="form-group form-group-sm">
			<label for="configName">Name</label>
			<input type="text" required class="form-control" id="configName" placeholder="configuration name" ng-model="config.name"/>
		  </div>
		  <div class="form-group">
			<label for="configNotes">Notes</label><br/>
			<textarea rows="5" class="form-control" id="configNotes" ng-model="config.notes" style="resize: vertical; font-size: 80%"/>
		  </div>
		  <div class="form-group form-group-sm">
			<label for="configTypeAuth">PDNS Authoritative</label><hr/>
		  </div>
		  <div class="form-group form-group-sm" ng-show="agent.protocol === 'dns'">
			<label for="authSource">PDNS Authoritative source</label>
			<select required class="form-control" id="authSource" ng-model="config.auth.source">
			  <option value="docker-image">PowerDNS Dockerhub Image</option>
			  <option value="build-from-repo">Build from repository</option>
			  <option value="deb-packages">Debian Packages</option>
			</select>
		  </div>
		  <div class="form-group form-group-sm" ng-if="config.auth.source === 'docker-image'">
			<label for="authDockerhubImageName">Image Name. (Default: powerdns/pdns-auth-master)</label>
			<input type="text" required class="form-control" id="authDockerhubImageName" placeholder="image name" ng-model="config.auth.dockerhub.name"/>
		  </div>
		  <div class="form-group form-group-sm" ng-if="config.auth.source === 'docker-image'">
			<label for="authDockerhubImageTag">Image Tag DockerHub. (Default: latest)</label>
			<input type="text" required class="form-control" id="authDockerhubImageTag" placeholder="image tag" ng-model="config.auth.dockerhub.tag"/>
		  </div>
		  <div class="form-group form-group-sm" ng-if="config.auth.source === 'build-from-repo'">
			<label for="authRepositoryUrl">Repository URL. (Default: https://github.com/PowerDNS/pdns.git)</label>
			<input type="text" required class="form-control" id="authRepositoryUrl" placeholder="Repo URL" ng-model="config.auth.repo.url"/>
		  </div>
		  <div class="form-group form-group-sm" ng-if="config.auth.source === 'build-from-repo'">
			<label for="authRepositoryBranch">Repository Branch. (Default: master)</label>
			<input type="text" required class="form-control" id="authRepositoryBranch" placeholder="Repo branch" ng-model="config.auth.repo.branch"/>
		  </div>
		  <div class="form-group form-group-sm" ng-if="config.auth.source === 'deb-packages'">
			<label for="authRelease">Debian package release. (Default: master)</label>
			<select required class="form-control" id="authRelease" ng-model="config.auth.package.version">
			  <option value="master">master</option>
			  <option value="48">4.8.X</option>
			  <option value="47">4.7.X</option>
			</select>
		  </div>
		  <div class="form-group form-group-sm">
			<label for="authConfigArgsServer">{{::agent.name}} command line options</label>
			<input class="form-control" id="authConfigArgsServer" ng-model="config.args.auth.server" ng-list=" " ng-trim="false" />
		  </div>
		  <div class="form-group form-group-sm">
			<label for="configTypeRec">PDNS Recursor</label><hr/>
		  </div>
		  <div class="form-group form-group-sm" ng-show="agent.protocol === 'dns'">
			<label for="recSource">PDNS Recursor source</label>
			<select required class="form-control" id="recSource" ng-model="config.rec.source">
			  <option value="docker-image">PowerDNS Dockerhub Image</option>
			  <option value="build-from-repo">Build from repository</option>
			  <option value="deb-packages">Debian Packages</option>
			</select>
		  </div>
		  <div class="form-group form-group-sm" ng-if="config.rec.source === 'docker-image'">
			<label for="recDockerhubImageName">Image Name. (Default: powerdns/pdns-recursor-master)</label>
			<input type="text" required class="form-control" id="recDockerhubImageName" placeholder="image name" ng-model="config.rec.dockerhub.name"/>
		  </div>
		  <div class="form-group form-group-sm" ng-if="config.rec.source === 'docker-image'">
			<label for="recDockerhubImageTag">Image Tag DockerHub. (Default: latest)</label>
			<input type="text" required class="form-control" id="recDockerhubImageTag" placeholder="image tag" ng-model="config.rec.dockerhub.tag"/>
		  </div>
		  <div class="form-group form-group-sm" ng-if="config.rec.source === 'build-from-repo'">
			<label for="recRepositoryUrl">Repository URL. (Default: https://github.com/PowerDNS/pdns.git)</label>
			<input type="text" required class="form-control" id="recRepositoryUrl" placeholder="Repo URL" ng-model="config.rec.repo.url"/>
		  </div>
		  <div class="form-group form-group-sm" ng-if="config.rec.source === 'build-from-repo'">
			<label for="recRepositoryBranch">Repository Branch. (Default: master)</label>
			<input type="text" required class="form-control" id="recRepositoryBranch" placeholder="Repo branch" ng-model="config.rec.repo.branch"/>
		  </div>
		  <div class="form-group form-group-sm" ng-if="config.rec.source === 'deb-packages'">
			<label for="recRelease">Debian package release. (Default: master)</label>
			<select required class="form-control" id="recRelease" ng-model="config.rec.package.version">
			  <option value="master">master</option>
			  <option value="49">4.9.X</option>
			  <option value="48">4.8.X</option>
			</select>
		  </div>
		  <div class="form-group form-group-sm">
			<label for="recConfigArgsServer">{{::agent.name}} command line options</label>
			<input class="form-control" id="recConfigArgsServer" ng-model="config.args.rec.server" ng-list=" " ng-trim="false" />
		  </div>
		  <div class="form-group form-group-sm" ng-if="clients && clients.length > 1">
			<label for="configClient">Test client application</label>
			<select ng-required="config.client !== ''" class="form-control" id="configClient" ng-model="config.client">
			  <option value="">- select client -</option>
			  <option ng-repeat="client in clients" value="{{client.key}}">{{client.name}}</option>
			</select>
		  </div>
		  <div class="form-group form-group-sm" ng-if="agent.protocol === 'dns'">
			<label for="configQueryset">Test client query Set</label>
			<select ng-required class="form-control" id="configQueryset" ng-model="config.queryset">
			  <option value="">- select set -</option>
			  <option ng-if="config.mode !== 'recursive'" value="default">Nominum default</option>
			  <option ng-if="config.mode !== 'recursive'" value="mega-small">1M small zones, 5% NXD</option>
			  <option ng-if="config.mode !== 'recursive'" value="kilo-small">1k small zones, 5% NXD</option>
			  <option ng-if="config.mode !== 'recursive'" value="update-clean-start">UPDATE, expect empty zones (dnsperf -u -n 1)</option>
			  <option ng-if="config.mode !== 'recursive'" value="update-renumber">UPDATE, expect 1M names with AAAA/PTR+DHCID and renumber all of them (dnsperf -u -n 1)</option>
			  <option ng-if="config.mode === 'recursive'" value="mega-small">1M zones, 5% NXD</option>
				<option ng-repeat="set in settings.querysets[config.mode]" value="{{set.file}}">{{set.name}}</option>
			</select>
		  </div>
		  <div class="form-group">
			<span class="btn-group" ng-show="config._id">
			  <span href="" class="fixed-button btn btn-sm btn-primary" ng-click="toggleArchived()">
			    <input type="checkbox" id="archived" ng-model="config.archived"/> Archived
			  </span>
			</span>
			<button class="fixed-button btn btn-sm btn-primary" ng-disabled="form.$invalid || form.$pristine || saving" ng-click="save()">
			  <span class="fas fa-fw fa-save"></span>Save</button>
			<button class="fixed-button btn btn-sm btn-primary" ng-disabled="form.$pristine || saving" ng-click="reset()">
			  <span class="fas fa-fw fa-times-circle"></span>Reset</button>
			<a href="#/config/clone/{{::config.type}}/{{::config._id}}" class="fixed-button btn btn-sm btn-primary" ng-disabled="form.$invalid || form.$dirty || saving" ng-show="config._id !== undefined">
			  <span class="fas fa-fw fa-clone"></span>Clone</a>
			<button class="fixed-button btn btn-sm btn-danger" data-toggle="modal" data-target="#confirm-delete" ng-show="config._id !== undefined" ng-disabled="saving">
			  <span class="fas fa-trash-alt"></span>Delete...</button>
		  </div>
		</form>
	  </div>
	  </div>
	</div>
  </div>
  <div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="delete" aria-hidden="true">
	<div class="modal-dialog">
	  <div class="modal-content">
		<div class="modal-header">
		  <h6 class="modal-title">Confirm Archive</h6>
		  <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
		</div>
		<div class="modal-body">
		  Please confirm that you want to delete this configuration.<br/>
		  This <u>will</u> permanently remove all related data.
		</div>
		<div class="modal-footer">
		  <button class="btn btn-default btn-outline-primary btn-sm" data-dismiss="modal">Cancel</button>
		  <button class="btn btn-danger btn-sm" data-dismiss="modal" ng-click="delete()">Delete</button>
		</div>
	  </div>
	</div>
  </div>
</div>
